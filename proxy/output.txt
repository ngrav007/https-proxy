==80355== Memcheck, a memory error detector
==80355== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==80355== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==80355== Command: ./bin/proxy 9055
==80355== 
[0;32m[+][0m [+] HTTP Proxy -----------------------------------
[0;33m[*][0m   Proxy Port = 9055
[0;33m[*][0m   Cache Size = 10
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: min timeout equal to threshold - timeout is NULL[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670824965.868970[0m
[0;32m[+] proxy: client 4 age: 0.003538[0m
[0;32m[+] proxy: timeout set to 29.996462[0m
[0;32m[+] proxy: timeout set to 29.996461[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handle] socket 4 matched on CLI_QUERY
[Proxy_handle] client 4 receiving
[Proxy_recv] Receiving from client: 4
[Proxy_recv] Client buffer size: 1024
[Proxy_recv] Client buffer length: 0
Bytes To Read: 1024
[1;33m[DEBUG][0m proxy: got header
[parse_request]: The request: 
CONNECT github.com:443 HTTP/1.1
Host: github.com:443
User-Agent: curl/7.81.0
Proxy-Connection: Keep-Alive


[parse_startline]: The request: 
connect github.com:443 http/1.1
host: github.com:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[parse_method]: The request: 
connect github.com:443 http/1.1
host: github.com:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[parse_method]: method: connect github.com:443 http/1.1
host: github.com:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[1;33m[DEBUG][0m query_new: host: github.com
[0;34m[*][0m proxy: got CONNECT request -- sending 200 OK response
[0;34m[*][0m proxy: client is in CONNECT state
[Proxy_Send] sending non-null buffer of size: 19.
[Proxy_send] Bytes sent: 19
Bytes To Write: 0
Bytes Written: 19
[0;32m[END PROXY SEND][0m
client->state = 3
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670824965.959639[0m
[0;32m[+] proxy: client 4 age: 0.071355[0m
[0;32m[+] proxy: timeout set to 29.928645[0m
[0;32m[+] proxy: timeout set to 29.928644[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[0;34m[*][0m proxy: client is in SSL state
[!] Domain name github.com already exists in /workspaces/Development/https-proxy/etc/ext/eregion.proxy.ext
[ProxySSL_accept] Checking for a SSL/TLS connection...
[ProxySSL_accept] SSL/TLS connection established!
[ProxySSL_accept] SSL/TLS connection established!
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670824966.419631[0m
[0;32m[+] proxy: client 4 age: 0.000579[0m
[0;32m[+] proxy: timeout set to 29.999421[0m
[0;32m[+] proxy: timeout set to 29.999421[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handle] socket 4 matched on CLI_QUERY
[Proxy_handle] ssl client 4 receiving
[ProxySSL_read] CLIENT matched on CLI_GET
buffer_l: 0
buffer_sz: 1024
[1;33m[DEBUG][0m proxy: got header
[parse_request]: The request: 
GET / HTTP/1.1
Host: github.com
User-Agent: curl/7.81.0
Accept: */*


[parse_startline]: The request: 
get / http/1.1
host: github.com
user-agent: curl/7.81.0
accept: */*


[parse_method]: The request: 
get / http/1.1
host: github.com
user-agent: curl/7.81.0
accept: */*


[parse_method]: method: get / http/1.1
host: github.com
user-agent: curl/7.81.0
accept: */*


[1;33m[DEBUG][0m query_new: host: github.com
[0;34m[*][0m proxy: got GET request
[Proxy_handleGET] CLIENT matched on CLI_GET
[Proxy_handleGET]: cache miss!
[Proxy_SSLconnect]: initializing SSL context...
[1;33m[DEBUG][0m [Proxy_SSLconnect]: connecting to server...
[1;33m[DEBUG][0m [Proxy_SSLconnect]: connected to server
[Proxy_SSLconnect]: SSL/TLS connection established!
[1;33m[DEBUG][0m [Proxy_SSLconnect]: SSL_write successful
[Proxy_SSLconnect]: sent request to server of 74 bytes
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670824966.704656[0m
[0;32m[+] proxy: client 4 age: 0.277808[0m
[0;32m[+] proxy: timeout set to 29.722192[0m
[0;32m[+] proxy: timeout set to 29.722191[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handleGET] QUERY matched on CLI_GET
[0;33m[?] proxy: buffer_l: 0[0m
BUFFER_SZ = 1024 BUFFER_L = 0
BUFFER_SZ = 1024 BUFFER_L = 0
Receiving 1024 bytes
[ProxySSL_read] QUERY matched on QUERY_TYPE
[ProxySSL_read] QUERY SSL_read returned 1024
HTTP/1.1 200 OK
Server: GitHub.com
Date: Mon, 12 Dec 2022 06:02:39 GMT
Content-Type: text/html; charset=utf-8
Vary: X-PJAX, X-PJAX-Container, Turbo-Visit, Turbo-Frame, Accept-Language, Accept-Encoding, Accept, X-Requested-With
content-language: en-US
ETag: W/"b94d3f155bf215c752915c41515d87f3"
Cache-Control: max-age=0, private, must-revalidate
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload
X-Frame-Options: deny
X-Content-Type-Options: nosniff
X-XSS-Protection: 0
Referrer-Policy: origin-when-cross-origin, strict-origin-when-cross-origin
Content-Security-Policy: default-src 'none'; base-uri 'self'; block-all-mixed-content; child-src github.com/assets-cdn/worker/ gist.github.com/assets-cdn/worker/; connect-src 'self' uploads.github.com objects-origin.githubusercontent.com www.githubstatus.com collector.github.com raw.githubusercontent.com api.github.com github-cloud.s3.amazonaws.com github-production-repository-file-5c1aeb.s3.amazonaws.com github-production-upload-manifest-fi
Received 1024 bytes
[Proxy_handleGET] QUERY state: 2
[Proxy_handleGET] handleQUERY ret: 0
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670824967.119997[0m
[0;32m[+] proxy: client 4 age: 0.693149[0m
[0;32m[+] proxy: timeout set to 29.306851[0m
[0;32m[+] proxy: timeout set to 29.306850[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handleGET] QUERY matched on CLI_GET
[0;33m[?] proxy: buffer_l: 1024[0m
BUFFER_SZ = 2048 BUFFER_L = 1024
BUFFER_SZ = 2048 BUFFER_L = 1024
Receiving 1024 bytes
[ProxySSL_read] QUERY matched on QUERY_TYPE
[ProxySSL_read] QUERY SSL_read returned 346
le-7fdce7.s3.amazonaws.com github-production-user-asset-6210df.s3.amazonaws.com cdn.optimizely.com logx.optimizely.com/v1/events *.actions.githubusercontent.com wss://*.actions.githubusercontent.com online.visualstudio.com/api/v1/locations github-production-repository-image-32fea6.s3.amazonaws.com github-production-release-asset-2e65be.s3.amazo
Received 202 bytes
[Proxy_handleGET] QUERY state: 3
[Proxy_handleGET] handleQUERY ret: 0
[Proxy_handleGET]: response received...
[0;33m[Proxy_handle]: sending SSL response to client 4[0m
len: 1370
HTTP/1.1 200 OK
Server: GitHub.com
Date: Mon, 12 Dec 2022 06:02:39 GMT
Content-Type: text/html; charset=utf-8
Vary: X-PJAX, X-PJAX-Container, Turbo-Visit, Turbo-Frame, Accept-Language, Accept-Encoding, Accept, X-Requested-With
content-language: en-US
ETag: W/"b94d3f155bf215c752915c41515d87f3"
Cache-Control: max-age=0, private, must-revalidate
Strict-Transport-Security: max-age=31536000; includeSubdomains; preload
X-Frame-Options: deny
X-Content-Type-Options: nosniff
X-XSS-Protection: 0
Referrer-Policy: origin-when-cross-origin, strict-origin-when-cross-origin
Content-Security-Policy: default-src 'none'; base-uri 'self'; block-all-mixed-content; child-src github.com/assets-cdn/worker/ gist.github.com/assets-cdn/worker/; connect-src 'self' uploads.github.com objects-origin.githubusercontent.com www.githubstatus.com collector.github.com raw.githubusercontent.com api.github.com github-cloud.s3.amazonaws.com github-production-repository-file-5c1aeb.s3.amazonaws.com github-production-upload-manifest-file-7fdce7.s3.amazonaws.com github-production-user-asset-6210df.s3.amazonaws.com cdn.optimizely.com logx.optimizely.com/v1/events *.actions.githubusercontent.com wss://*.actions.githubusercontent.com online.visualstudio.com/api/v1/locations github-production-repository-image-32fea6.s3.amazonaws.com github-production-release-asset-2e65be.s3.amazo
[ProxySSL_write] Writing to client: 4
[0;31m[!][0m proxy: failed to send response to client
[Event_Handle] ErrorCode = -9
[0;31m[!][0m proxy: failed to establish SSL connection
[Proxy_Send] sending non-null buffer of size: 29.
[Proxy_send] Bytes sent: 29
Bytes To Write: 0
Bytes Written: 29
[0;32m[END PROXY SEND][0m
[0;33m[?] Closing Socket # = 4[0m
[0;33m[?] Remove Socket # from master_set = 4[0m
[0;33m[?] Remove Socket # from client_list = 4[0m
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: min timeout equal to threshold - timeout is NULL[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670825060.663641[0m
[0;32m[+] proxy: client 4 age: 0.001693[0m
[0;32m[+] proxy: timeout set to 29.998307[0m
[0;32m[+] proxy: timeout set to 29.998306[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handle] socket 4 matched on CLI_QUERY
[Proxy_handle] client 4 receiving
[Proxy_recv] Receiving from client: 4
[Proxy_recv] Client buffer size: 1024
[Proxy_recv] Client buffer length: 0
Bytes To Read: 1024
[1;33m[DEBUG][0m proxy: got header
[parse_request]: The request: 
CONNECT httpbin.org:443 HTTP/1.1
Host: httpbin.org:443
User-Agent: curl/7.81.0
Proxy-Connection: Keep-Alive


[parse_startline]: The request: 
connect httpbin.org:443 http/1.1
host: httpbin.org:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[parse_method]: The request: 
connect httpbin.org:443 http/1.1
host: httpbin.org:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[parse_method]: method: connect httpbin.org:443 http/1.1
host: httpbin.org:443
user-agent: curl/7.81.0
proxy-connection: keep-alive


[1;33m[DEBUG][0m query_new: host: httpbin.org
[0;34m[*][0m proxy: got CONNECT request -- sending 200 OK response
[0;34m[*][0m proxy: client is in CONNECT state
[Proxy_Send] sending non-null buffer of size: 19.
[Proxy_send] Bytes sent: 19
Bytes To Write: 0
Bytes Written: 19
[0;32m[END PROXY SEND][0m
client->state = 3
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670825060.703164[0m
[0;32m[+] proxy: client 4 age: 0.031054[0m
[0;32m[+] proxy: timeout set to 29.968946[0m
[0;32m[+] proxy: timeout set to 29.968945[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[0;34m[*][0m proxy: client is in SSL state
[!] Domain name httpbin.org already exists in /workspaces/Development/https-proxy/etc/ext/eregion.proxy.ext
[ProxySSL_accept] Checking for a SSL/TLS connection...
[ProxySSL_accept] SSL/TLS connection established!
[ProxySSL_accept] SSL/TLS connection established!
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670825060.847111[0m
[0;32m[+] proxy: client 4 age: 0.000538[0m
[0;32m[+] proxy: timeout set to 29.999462[0m
[0;32m[+] proxy: timeout set to 29.999462[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handle] socket 4 matched on CLI_QUERY
[Proxy_handle] ssl client 4 receiving
[ProxySSL_read] CLIENT matched on CLI_GET
buffer_l: 0
buffer_sz: 1024
[1;33m[DEBUG][0m proxy: got header
[parse_request]: The request: 
GET /ip HTTP/1.1
Host: httpbin.org
User-Agent: curl/7.81.0
Accept: */*


[parse_startline]: The request: 
get /ip http/1.1
host: httpbin.org
user-agent: curl/7.81.0
accept: */*


[parse_method]: The request: 
get /ip http/1.1
host: httpbin.org
user-agent: curl/7.81.0
accept: */*


[parse_method]: method: get /ip http/1.1
host: httpbin.org
user-agent: curl/7.81.0
accept: */*


[1;33m[DEBUG][0m query_new: host: httpbin.org
[0;34m[*][0m proxy: got GET request
[Proxy_handleGET] CLIENT matched on CLI_GET
[Proxy_handleGET]: cache miss!
[Proxy_SSLconnect]: initializing SSL context...
[1;33m[DEBUG][0m [Proxy_SSLconnect]: connecting to server...
[1;33m[DEBUG][0m [Proxy_SSLconnect]: connected to server
[Proxy_SSLconnect]: SSL/TLS connection established!
[1;33m[DEBUG][0m [Proxy_SSLconnect]: SSL_write successful
[Proxy_SSLconnect]: sent request to server of 77 bytes
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670825061.107450[0m
[0;32m[+] proxy: client 4 age: 0.254181[0m
[0;32m[+] proxy: timeout set to 29.745819[0m
[0;32m[+] proxy: timeout set to 29.745818[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handleGET] QUERY matched on CLI_GET
[0;33m[?] proxy: buffer_l: 0[0m
BUFFER_SZ = 1024 BUFFER_L = 0
BUFFER_SZ = 1024 BUFFER_L = 0
Receiving 1024 bytes
[ProxySSL_read] QUERY matched on QUERY_TYPE
[ProxySSL_read] QUERY SSL_read returned 261
HTTP/1.1 200 OK
Date: Mon, 12 Dec 2022 06:04:21 GMT
Content-Type: application/json
Content-Length: 32
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "origin": "24.147.244.22"
}

Received 202 bytes
[Proxy_handleGET] QUERY state: 3
[Proxy_handleGET] handleQUERY ret: 0
[Proxy_handleGET]: response received...
[0;33m[Proxy_handle]: sending SSL response to client 4[0m
len: 261
HTTP/1.1 200 OK
Date: Mon, 12 Dec 2022 06:04:21 GMT
Content-Type: application/json
Content-Length: 32
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "origin": "24.147.244.22"
}

[ProxySSL_write] Writing to client: 4
[0;31m[!][0m proxy: failed to send response to client
[Event_Handle] ErrorCode = -9
[0;31m[!][0m proxy: failed to establish SSL connection
[Proxy_Send] sending non-null buffer of size: 29.
[Proxy_send] Bytes sent: 29
Bytes To Write: 0
Bytes Written: 29
[0;32m[END PROXY SEND][0m
[0;33m[?] Closing Socket # = 4[0m
[0;33m[?] Remove Socket # from master_set = 4[0m
[0;33m[?] Remove Socket # from client_list = 4[0m
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: min timeout equal to threshold - timeout is NULL[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[1;33m[DEBUG][0m proxy: waiting for connections
[0;32m[+] proxy: client 4 now: 1670825112.661104[0m
[0;32m[+] proxy: client 4 age: 0.001395[0m
[0;32m[+] proxy: timeout set to 29.998605[0m
[0;32m[+] proxy: timeout set to 29.998605[0m
[Proxy_run] select returned: 1
[Proxy_run] calling Proxy_handle
[Proxy_handle] socket 4 matched on CLI_QUERY
[Proxy_handle] client 4 receiving
[Proxy_recv] Receiving from client: 4
[Proxy_recv] Client buffer size: 1024
[Proxy_recv] Client buffer length: 0
Bytes To Read: 1024
[1;33m[DEBUG][0m proxy: got header
[parse_request]: The request: 
__halt__ / HTTP/1.1
Host: eregion.proxy
Connection: close


[parse_startline]: The request: 
__halt__ / http/1.1
host: eregion.proxy
connection: close


[parse_method]: The request: 
__halt__ / http/1.1
host: eregion.proxy
connection: close


[parse_method]: method: __halt__ / http/1.1
host: eregion.proxy
connection: close


[0;31m[!][0m proxy: failed to parse request
[Event_Handle] ErrorCode = 666
[0;34m[*][0m proxy: halt signal received
[Proxy_Send] sending non-null buffer of size: 20.
[Proxy_send] Bytes sent: 20
Bytes To Write: 0
Bytes Written: 20
[0;32m[END PROXY SEND][0m
[0;34m[*][0m proxy: shutting down
FREESING Proxy
==80355== 
==80355== HEAP SUMMARY:
==80355==     in use at exit: 1,633 bytes in 2 blocks
==80355==   total heap usage: 56,868 allocs, 56,866 frees, 6,254,923 bytes allocated
==80355== 
==80355== 1,633 bytes in 2 blocks are definitely lost in loss record 1 of 1
==80355==    at 0x4869F34: calloc (in /usr/libexec/valgrind/vgpreload_memcheck-arm64-linux.so)
==80355==    by 0x1128E7: Proxy_sendServerResp (proxy.c:985)
==80355==    by 0x111DB3: Proxy_handleGET (proxy.c:733)
==80355==    by 0x112643: Proxy_handle (proxy.c:932)
==80355==    by 0x113A57: select_loop (proxy.c:1398)
==80355==    by 0x1102C7: Proxy_run (proxy.c:51)
==80355==    by 0x10EF27: main (http-proxy.c:99)
==80355== 
==80355== LEAK SUMMARY:
==80355==    definitely lost: 1,633 bytes in 2 blocks
==80355==    indirectly lost: 0 bytes in 0 blocks
==80355==      possibly lost: 0 bytes in 0 blocks
==80355==    still reachable: 0 bytes in 0 blocks
==80355==         suppressed: 0 bytes in 0 blocks
==80355== 
==80355== For lists of detected and suppressed errors, rerun with: -s
==80355== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)

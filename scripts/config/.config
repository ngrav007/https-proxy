#!/bin/bash

# Configuration file for scripts in parent directory - defines constants

# Workspace Directory
WORKSPACE="/workspaces"
DEV_DIR="${WORKSPACE}/Development"
WORK_DIR="${DEV_DIR}/https-proxy"
ETC_DIR="${DEV_DIR}/etc"
CERTS_DIR="${ETC_DIR}/certs"
KEYS_DIR="${ETC_DIR}/private"
PASSWD_DIR="${ETC_DIR}/passwd"
EXT_DIR="${ETC_DIR}/ext"

# CA Certificate Directory
CA_CERTS_DIR="/usr/local/share/ca-certificates"

# Trusted Certificate Directory
SSL_CERTS_DIR="/etc/ssl/certs"

# Trusted Private Key Directory
SSL_PRIVATE_DIR="/etc/ssl/private"

# OpenSSL Configuration File
OPENSSL_CNF="/etc/ssl/openssl.cnf"

# Subject Fields
COUNTRY=US
STATE=MA
LOCALITY=Local
ORGANIZATION=Eregion
ORGANIZATION_UNIT=Eregion

SUBJECT="/C=${COUNTRY}/ST=${STATE}/L=${LOCALITY}/O=${ORGANIZATION}/OU=${ORGANIZATION_UNIT}/CN="

# Default Dev Password
DEFAULT_DEV_PASSWD="dev"

# Ensure each directory exists
if [ ! -d "${WORKSPACE}" ]; then
    echo "[!] Workspace directory ${WORKSPACE} not found"
    exit 1
fi

if [ ! -d "${DEV_DIR}" ]; then
    echo "[!] Development directory ${DEV_DIR} not found"
    exit 1
fi

if [ ! -d "${WORK_DIR}" ]; then
    echo "[!] Work directory ${WORK_DIR} not found"
    exit 1
fi

if [ ! -d "${CERTS_DIR}" ]; then
    echo "[!] Certificate directory ${CERTS_DIR} not found"
    exit 1
fi

if [ ! -d "${KEYS_DIR}" ]; then
    echo "[!] Private Key directory ${KEYS_DIR} not found"
    exit 1
fi

if [ ! -d "${PASSWD_DIR}" ]; then
    echo "[!] Password directory ${PASSWD_DIR} not found"
    exit 1
fi

if [ ! -d "${CA_CERTS_DIR}" ]; then
    echo "[!] CA Certificate directory ${CA_CERT_DIR} not found"
    exit 1
fi

if [ ! -d "${SSL_CERTS_DIR}" ]; then
    echo "[!] Trusted Certificate directory ${TRUSTED_CERT_DIR} not found"
    exit 1
fi

if [ ! -d "${SSL_PRIVATE_DIR}" ]; then
    echo "[!] Trusted Private Key directory ${TRUSTED_PRIVATE_KEY_DIR} not found"
    exit 1
fi

if [ ! -f "${OPENSSL_CNF}" ]; then
    echo "[!] OpenSSL configuration file ${OPENSSL_CNF} not found"
    exit 1
fi

if [ ! -d "${EXT_DIR}" ]; then
    echo "[!] Extension directory ${EXT_DIR} not found"
    exit 1
fi

# ROOT CA - Local
ROOT_CA_CN=eregion.local

ROOT_CA_CRT=${CERTS_DIR}/${ROOT_CA_CN}.pem
if [ ! -f "${ROOT_CA_CRT}" ]; then
    echo "[!] Root CA certificate ${ROOT_CA_CRT} not found"
    exit 1
fi

ROOT_CA_KEY=${KEYS_DIR}/${ROOT_CA_CN}.key
if [ ! -f "${ROOT_CA_KEY}" ]; then
    echo "[!] Root CA private key ${ROOT_CA_KEY} not found"
    exit 1
fi

ROOT_CA_PASSWD=${PASSWD_DIR}/${ROOT_CA_CN}.passwd
if [ ! -f "${ROOT_CA_PASSWD}" ]; then
    echo "[!] Root CA password file ${ROOT_CA_PASSWD} not found"
    exit 1
fi


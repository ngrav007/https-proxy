#!/bin/bash

# Test 03: Test the http-proxy with a binary file GET request and response
TESTNAME=$(basename $0)
OUTDIR=$(dirname $0)/output
OUTFILE=${OUTDIR}/${TESTNAME%.*}.out

# Start timer for test
echo "+ ------- Test 09: Binary File CONNECT request and response ------- +"

echo "[*] Sending initial request to https://www.cs.cmu.edu/~dga/dga-headshot.jpg..."
fetch=$(time curl -v --output ${OUTFILE} -p -x localhost:9056 https://www.cs.cmu.edu/~dga/dga-headshot.jpg 2>&1)

echo "[*] Sleeping for 5 seconds..."
for i in {1..5}; do
    echo -n "."
    sleep 1
done
echo ""

echo "[*] Sending second request to https://www.cs.cmu.edu/~dga/dga-headshot.jpg..."
cache=$(time curl -v --output ${OUTFILE} -p -x localhost:9056 https://www.cs.cmu.edu/~dga/dga-headshot.jpg 2>&1)

echo "[+] Results ----------------------------------------------- +"
echo ""
echo "    [*] Time Elapsed w/ Fetch: $fetch"
echo "    [*] Time Elapsed w/ Cache: $cache"
echo ""
echo "+ --------------------------------------------------------- +"
